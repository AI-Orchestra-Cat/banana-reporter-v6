<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>バナナレポーター - 品質管理システム v6.3</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 認証画面 -->
    <div id="authScreen" class="auth-screen">
        <div class="container">
            <div class="auth-card">
                <div class="header">
                    <h1>🍌 バナナレポーター</h1>
                    <p class="subtitle">品質管理システム v6.3</p>
                    <p class="version-info">GitHub Pages + Edge Functions版</p>
                </div>

                <div class="alert" id="authAlert"></div>

                <form class="auth-form" id="loginForm">
                    <div class="form-group">
                        <label class="form-label">ユーザーID</label>
                        <input type="text" class="form-control" id="userId" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">パスワード</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
                        ログイン
                    </button>
                </form>

                <div class="loading" id="loginLoading">
                    <div class="spinner"></div>
                    <p>認証中...</p>
                </div>

                <!-- 開発用情報（本番では削除） -->
                <div class="initial-user-info hidden" id="initialUserInfo">
                    <h4>開発用ログイン情報</h4>
                    <p>管理者: admin / Bn@7QcX9</p>
                    <p>達人: expert1 / expert2024</p>
                    <p>一般: user1 / user2024</p>
                </div>
            </div>
        </div>
    </div>

    <!-- メイン画面 -->
    <div id="mainScreen" class="hidden">
        <div class="container">
            <!-- ヘッダー -->
            <div class="header">
                <h1>🍌 バナナレポーター</h1>
                <div class="user-info">
                    <span class="user-name" id="userName">ゲスト</span>
                    <span class="user-role" id="userRole">GUEST</span>
                    <button class="btn btn-outline" id="logoutBtn">ログアウト</button>
                </div>
            </div>

            <!-- アラート表示 -->
            <div class="alert hidden" id="mainAlert"></div>

            <!-- 画像入力セクション -->
            <div class="card">
                <h3 class="mb-10">📷 画像入力</h3>
                <div class="image-input-section">
                    <div class="btn-group">
                        <label class="btn btn-primary" for="cameraInput">
                            📱 カメラ撮影
                            <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden">
                        </label>
                        <label class="btn btn-secondary" for="fileInput">
                            📁 ファイル選択
                            <input type="file" id="fileInput" accept="image/*" class="hidden">
                        </label>
                    </div>
                </div>
                
                <div class="image-preview" id="imagePreview">
                    <div class="image-placeholder">画像が選択されていません</div>
                </div>
            </div>

            <!-- 目視判定セクション -->
            <div class="visual-judgment-section hidden" id="visualJudgmentCard">
                <h4 class="mb-10">👁️ 目視判定（任意）</h4>
                <p class="form-text">アプリ判定と異なる場合のみ選択してください</p>
                
                <div class="visual-color-chart">
                    <div class="visual-color-item" data-level="2">
                        <div class="color-circle color-2"></div>
                        <div class="color-level">2</div>
                        <div class="color-name">オール<br>グリーン</div>
                    </div>
                    <div class="visual-color-item" data-level="3">
                        <div class="color-circle color-3"></div>
                        <div class="color-level">3</div>
                        <div class="color-name">ライト<br>グリーン</div>
                    </div>
                    <div class="visual-color-item" data-level="4">
                        <div class="color-circle color-4"></div>
                        <div class="color-level">4</div>
                        <div class="color-name">ハーフ<br>グリーン</div>
                    </div>
                    <div class="visual-color-item" data-level="5">
                        <div class="color-circle color-5"></div>
                        <div class="color-level">5</div>
                        <div class="color-name">グリーン<br>チップ</div>
                    </div>
                    <div class="visual-color-item" data-level="6">
                        <div class="color-circle color-6"></div>
                        <div class="color-level">6</div>
                        <div class="color-name">フル<br>イエロー</div>
                    </div>
                    <div class="visual-color-item" data-level="7">
                        <div class="color-circle color-7"></div>
                        <div class="color-level">7</div>
                        <div class="color-name">スター</div>
                    </div>
                    <div class="visual-color-item" data-level="8">
                        <div class="color-circle color-8"></div>
                        <div class="color-level">8</div>
                        <div class="color-name">過熟</div>
                    </div>
                    <div class="visual-color-item" data-level="9">
                        <div class="color-circle color-9"></div>
                        <div class="color-level">9</div>
                        <div class="color-name">褐色</div>
                    </div>
                </div>
                
                <div class="form-group mt-10">
                    <input type="text" class="form-control" id="visualJudgmentMemo" 
                           placeholder="判定理由やメモ（任意）">
                </div>
            </div>

            <!-- 解析実行ボタン -->
            <div class="analyze-button-container">
                <button class="btn btn-success btn-analyze" id="analyzeBtn" disabled>
                    🔍 解析実行
                </button>
            </div>

            <!-- カラーチャート表示セクション -->
            <div class="card">
                <h3 class="mb-10">🎨 カラーチャート</h3>
                <div class="color-chart">
                    <div class="color-item clickable" data-level="2">
                        <div class="color-circle color-2"></div>
                        <div class="color-info">
                            <div class="color-level">2</div>
                            <div class="color-name">オールグリーン</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="3">
                        <div class="color-circle color-3"></div>
                        <div class="color-info">
                            <div class="color-level">3</div>
                            <div class="color-name">ライトグリーン</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="4">
                        <div class="color-circle color-4"></div>
                        <div class="color-info">
                            <div class="color-level">4</div>
                            <div class="color-name">ハーフグリーン</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="5">
                        <div class="color-circle color-5"></div>
                        <div class="color-info">
                            <div class="color-level">5</div>
                            <div class="color-name">グリーンチップ</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="6">
                        <div class="color-circle color-6"></div>
                        <div class="color-info">
                            <div class="color-level">6</div>
                            <div class="color-name">フルイエロー</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="7">
                        <div class="color-circle color-7"></div>
                        <div class="color-info">
                            <div class="color-level">7</div>
                            <div class="color-name">スター</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="8">
                        <div class="color-circle color-8"></div>
                        <div class="color-info">
                            <div class="color-level">8</div>
                            <div class="color-name">過熟</div>
                        </div>
                    </div>
                    <div class="color-item clickable" data-level="9">
                        <div class="color-circle color-9"></div>
                        <div class="color-info">
                            <div class="color-level">9</div>
                            <div class="color-name">褐色</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 解析結果表示セクション -->
            <div class="card hidden" id="resultCard">
                <h3 class="mb-20">📊 解析結果</h3>
                <div class="result-section">
                    <div class="ripeness-indicator" id="ripenessIndicator">
                        <div class="ripeness-stage" id="ripenessStage">
                            <span class="stage-label">熟度判定</span>
                            <span class="stage-value" id="stageValue">-</span>
                        </div>
                        <div class="ripeness-visual" id="ripenessVisual">
                            <!-- カラーチャート連動表示 -->
                        </div>
                    </div>
                    <div class="result-details">
                        <div class="description-box" id="descriptionBox">
                            <h4>状態説明</h4>
                            <p id="stageDescription">-</p>
                        </div>
                        <div class="recommendation-box" id="recommendationBox">
                            <h4>推奨用途</h4>
                            <p id="stageRecommendation">-</p>
                        </div>
                    </div>
                    <div class="result-content" id="resultContent">
                        <!-- 詳細データ -->
                    </div>
                </div>
            </div>

            <!-- 商品情報入力セクション -->
            <div class="card">
                <h3 class="mb-10">📝 商品情報</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label required">クレーム種別</label>
                        <select class="form-control" id="claimType" required>
                            <option value="">選択してください</option>
                            <option value="軸腐れ・先腐れ">軸腐れ・先腐れ</option>
                            <option value="傷">傷</option>
                            <option value="病害虫">病害虫</option>
                            <option value="熟度不足">熟度不足</option>
                            <option value="過熟">過熟</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">到着日</label>
                        <input type="date" class="form-control" id="deliveryDate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">撮影日</label>
                        <input type="date" class="form-control" id="captureDate">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">商品名</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">チェーン名</label>
                        <input type="text" class="form-control" id="chainName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">店舗名</label>
                        <input type="text" class="form-control" id="storeName">
                    </div>

                    <div class="form-group">
                        <label class="form-label">数量</label>
                        <input type="number" class="form-control" id="quantity" min="0" step="1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">単位</label>
                        <select class="form-control" id="unit">
                            <option value="ケース">ケース</option>
                            <option value="パック">パック</option>
                            <option value="本">本</option>
                            <option value="袋">袋</option>
                            <option value="kg">kg</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="code1Label">汎用コード1</label>
                        <input type="text" class="form-control" id="code1">
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="code2Label">汎用コード2</label>
                        <input type="text" class="form-control" id="code2">
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="code3Label">汎用コード3</label>
                        <input type="text" class="form-control" id="code3">
                    </div>

                    <div class="form-group">
                        <label class="form-label">希望クレーム請求金額</label>
                        <input type="number" class="form-control" id="claimAmount" min="0">
                    </div>
                </div>
            </div>

            <!-- アクションボタン -->
            <div class="action-buttons">
                <button class="btn btn-info" id="exportBtn" disabled>📋 CSV出力</button>
                <button class="btn btn-primary" id="sendMailBtn" disabled>📧 メール送信</button>
                <button class="btn btn-warning" id="resetBtn">🔄 リセット</button>
            </div>

            <!-- 管理者ボタン -->
            <div class="admin-btn-group hidden" id="adminBtnGroup">
                <button class="btn btn-outline role-admin role-expert" id="adminSettingsBtn">⚙️ 設定</button>
            </div>

            <!-- ローディング -->
            <div class="loading hidden" id="mainLoading">
                <div class="spinner"></div>
                <p>解析中...</p>
            </div>
        </div>
    </div>

    <!-- 管理者設定パネル -->
    <div class="modal hidden" id="adminPanel">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="admin-title">⚙️ 管理者設定</h3>
                <button class="btn-close" id="closeAdminBtn">×</button>
            </div>
            <div class="modal-body">
                <!-- コード名称設定（管理者のみ） -->
                <div class="role-admin">
                    <h4 class="mb-10">汎用コード名称設定</h4>
                    <div class="card">
                        <div class="form-group">
                            <label class="form-label">汎用コード1 名称</label>
                            <input type="text" class="form-control" id="customCode1Label" value="汎用コード1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">汎用コード2 名称</label>
                            <input type="text" class="form-control" id="customCode2Label" value="汎用コード2">
                        </div>
                        <div class="form-group">
                            <label class="form-label">汎用コード3 名称</label>
                            <input type="text" class="form-control" id="customCode3Label" value="汎用コード3">
                        </div>
                        <button class="btn btn-primary" id="saveCodeLabelsBtn">保存</button>
                    </div>
                </div>

                <!-- Edge Function テスト -->
                <div class="role-admin role-expert">
                    <h4 class="mb-10">システムテスト</h4>
                    <div class="card">
                        <button class="btn btn-info" id="testEdgeFunctionBtn">Edge Function テスト</button>
                        <button class="btn btn-secondary" id="testOfflineModeBtn">オフラインモード テスト</button>
                    </div>
                </div>

                <!-- 解析パラメータ設定（達人・管理者） -->
                <div class="role-admin role-expert">
                    <h4 class="mb-10">解析パラメータ設定</h4>
                    <div class="card">
                        <p class="form-text">※ 上級者向け機能です。変更は慎重に行ってください。</p>
                        <div class="param-grid">
                            <div class="param-group">
                                <label class="param-label">緑色閾値</label>
                                <input type="range" class="param-range" id="greenThreshold" min="0" max="100" value="30">
                                <span class="param-value">30%</span>
                            </div>
                            <div class="param-group">
                                <label class="param-label">黄色閾値</label>
                                <input type="range" class="param-range" id="yellowThreshold" min="0" max="100" value="40">
                                <span class="param-value">40%</span>
                            </div>
                            <div class="param-group">
                                <label class="param-label">スポット閾値</label>
                                <input type="range" class="param-range" id="spotThreshold" min="0" max="50" value="15">
                                <span class="param-value">15%</span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success" id="saveParamsBtn">パラメータ保存</button>
                            <button class="btn btn-warning" id="resetParamsBtn">初期値に戻す</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript読み込み -->
    <script src="app.js"></script>
</body>
</html>